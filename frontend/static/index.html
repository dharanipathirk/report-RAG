<!DOCTYPE html>
<!-- Main HTML file for Report-RAG.
     Contains the login and chat interfaces along with client-side scripts for authentication and messaging.
-->
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Report-RAG</title>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@32,400,0,0" />
  <link rel="stylesheet" href="/static/styles.css" />
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.0/purify.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/atom-one-dark.min.css">
  <!-- Alternative highlight.js themes (commented out)
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/vs2015.min.css">
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/github.min.css">
  -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script>
</head>

<body>
  <div id="loading">
    <section class="section_home-hero">
      <div class="w-layout-grid home-hero_component">
        <div class="home-hero_card">
          <div class="hero-animated-gradient">
            <div class="gradient-circle-1"
              style="transform: translate3d(18.5975%, 78.5975%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
            </div>
            <div class="gradient-circle-2"
              style="transform: translate3d(-98.5975%, 9.1585%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
            </div>
            <div class="gradient-circle-3"
              style="transform: translate3d(1.4025%, 98.5975%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
            </div>
            <div class="gradient-circle-4"
              style="transform: translate3d(-18.0365%, -59.1585%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
            </div>
            <div class="gradient-circle-5"
              style="transform: translate3d(11.122%, 20.561%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
  <div id="login-container" class="login-page" style="display: none;">
    <div class="page-wrapper">
      <section class="section_home-hero">
        <div class="w-layout-grid home-hero_component">
          <div class="home-hero_card">
            <div class="hero-animated-gradient">
              <div class="gradient-circle-1"
                style="transform: translate3d(18.5975%, 78.5975%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
              </div>
              <div class="gradient-circle-2"
                style="transform: translate3d(-98.5975%, 9.1585%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
              </div>
              <div class="gradient-circle-3"
                style="transform: translate3d(1.4025%, 98.5975%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
              </div>
              <div class="gradient-circle-4"
                style="transform: translate3d(-18.0365%, -59.1585%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
              </div>
              <div class="gradient-circle-5"
                style="transform: translate3d(11.122%, 20.561%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
              </div>
            </div>
          </div>
        </div>
      </section>
      <div class="wrapper">
        <form action="" id="loginForm">
          <div class="input-box">
            <input type="text" placeholder="Username" id="username" name="username" autocomplete="off" required>
            <i class='bx bxs-user'></i>
          </div>
          <div class="input-box">
            <input type="password" placeholder="Password" id="password" name="password" autocomplete="off" required>
            <i class='bx bxs-lock-alt'></i>
          </div>
          <button type="submit" class="btn">Login</button>
        </form>
      </div>
    </div>
  </div>
  <div id="chat-container" style="display: none;">
    <div class="page-wrapper">
      <section class="section_home-hero">
        <div class="w-layout-grid home-hero_component">
          <div class="home-hero_card">
            <div class="hero-animated-gradient">
              <div class="gradient-circle-1"
                style="transform: translate3d(18.5975%, 78.5975%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
              </div>
              <div class="gradient-circle-2"
                style="transform: translate3d(-98.5975%, 9.1585%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
              </div>
              <div class="gradient-circle-3"
                style="transform: translate3d(1.4025%, 98.5975%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
              </div>
              <div class="gradient-circle-4"
                style="transform: translate3d(-18.0365%, -59.1585%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
              </div>
              <div class="gradient-circle-5"
                style="transform: translate3d(11.122%, 20.561%, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg); transform-style: preserve-3d; will-change: transform;">
              </div>
            </div>
            <div class="hero-bg-abstract-shapes-wrap">
              <img id="image-1"
                src="https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348af7287ce7c2a304e3a4_Abstract%20Shape%203.webp"
                loading="eager" sizes="(max-width: 479px) 145.109375px, (max-width: 767px) 241.859375px, 290.234375px"
                srcset="https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348af7287ce7c2a304e3a4_Abstract%20Shape%203-p-500.webp 500w,
                        https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348af7287ce7c2a304e3a4_Abstract%20Shape%203-p-800.webp 800w,
                        https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348af7287ce7c2a304e3a4_Abstract%20Shape%203-p-1080.webp 1080w,
                        https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348af7287ce7c2a304e3a4_Abstract%20Shape%203-p-1600.webp 1600w,
                        https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348af7287ce7c2a304e3a4_Abstract%20Shape%203.webp 2000w"
                alt="" class="abstract-shape shape-4">
              <img id="image-2"
                src="https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348a2e912ec5fe0fce931c_Abstract%20Shape%203.webp"
                loading="eager" sizes="(max-width: 479px) 128px, (max-width: 767px) 192px, 256px"
                srcset="https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348a2e912ec5fe0fce931c_Abstract%20Shape%203-p-500.webp 500w,
                        https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348a2e912ec5fe0fce931c_Abstract%20Shape%203-p-800.webp 800w,
                        https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348a2e912ec5fe0fce931c_Abstract%20Shape%203-p-1080.webp 1080w,
                        https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348a2e912ec5fe0fce931c_Abstract%20Shape%203-p-1600.webp 1600w,
                        https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348a2e912ec5fe0fce931c_Abstract%20Shape%203.webp 2000w" alt="" class="abstract-shape shape-3">
              <img id="image-3"
                src="https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348af7a0774210bafec23e_Abstract%20Shape%202.webp"
                loading="eager" alt="" class="abstract-shape shape-2">
              <img id="image-4"
                src="https://cdn.prod.website-files.com/6605d052b6285185135a565d/66348a02c0b49cc1e6670385_Abstract%20Shape%201.webp"
                loading="eager" alt="" class="abstract-shape shape-1">
            </div>
          </div>
        </div>
      </section>
      <div class="container">
        <header class="app-header">
          <h1 class="heading">Hello, there</h1>
          <h4 class="sub-heading">Got a business question?</h4>
        </header>
        <ul class="suggestions">
          <li class="suggestions-item">
            <p class="text">How is the company engaging with stakeholders?</p>
            <span class="icon material-symbols-rounded">campaign</span>
          </li>
          <li class="suggestions-item">
            <p class="text">What innovations support the net-zero transition?</p>
            <span class="icon material-symbols-rounded">lightbulb</span>
          </li>
          <li class="suggestions-item">
            <p class="text">How does the company allocate capital?</p>
            <span class="icon material-symbols-rounded">shopping_cart</span>
          </li>
          <li class="suggestions-item">
            <p class="text">How does the company support employees and communities?</p>
            <span class="icon material-symbols-rounded">favorite</span>
          </li>
        </ul>
        <div class="chats-container"></div>
        <div class="prompt-container">
          <div class="prompt-wrapper">
            <form action="#" class="prompt-form">
              <input type="text" placeholder="Ask here for insights ✨" class="prompt-input" required />
              <div class="prompt-actions">
                <button id="use-report-btn" type="button" class="material-symbols-rounded">picture_as_pdf</button>
                <div class="file-upload-wrapper">
                  <img src="#" class="file-preview" />
                  <input id="file-input" type="file" accept=".pdf, application/pdf" hidden />
                  <button type="button" class="file-icon material-symbols-rounded">description</button>
                  <button id="cancel-file-btn" type="button" class="material-symbols-rounded">close</button>
                  <button id="add-file-btn" type="button" class="material-symbols-rounded">attach_file</button>
                </div>
                <button id="stop-response-btn" type="button" class="material-symbols-rounded">stop_circle</button>
                <button id="send-prompt-btn" class="material-symbols-rounded">arrow_upward</button>
              </div>
            </form>
            <button id="delete-chats-btn" class="material-symbols-rounded">delete</button>
          </div>

          <p class="disclaimer-text">Your Data. Our Insights. Smarter Decisions - Powered by ColQWen2 & GPT-4o</p>
        </div>
      </div>
    </div>
  </div>
  <!-- Image Viewer Modal -->
  <div id="image-viewer" class="image-viewer">
    <img id="viewer-image" src="" />
  </div>

  <script src="/config.js"></script>
  <script>
    /**
     * Checks user authentication status by sending a GET request to the token validation endpoint.
     * If authenticated, displays the chat interface; otherwise, shows the login form.
     */
    async function checkAuth() {
      try {
        const response = await fetch('/api/validate-token', {
          method: 'GET',
          credentials: 'include'
        });

        if (response.ok) {
          document.getElementById('login-container').style.display = 'none';
          document.getElementById('chat-container').style.display = 'block';
        } else {
          showLogin();
        }
      } catch (error) {
        showLogin();
      } finally {
        document.getElementById('loading').style.display = 'none';
      }
    }

    /**
     * Displays the login form and hides the chat interface.
     */
    function showLogin() {
      document.getElementById('login-container').style.display = 'flex';
      document.getElementById('chat-container').style.display = 'none';
    }

    /**
     * Handles login form submission by sending credentials to the login API.
     * On success, rechecks authentication; on failure, alerts the user.
     */
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const username = formData.get("username");
      const password = formData.get("password");

      try {
        const response = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ username, password }),
          credentials: 'include'
        });

        if (response.ok) {
          await checkAuth();
        } else {
          const data = await response.json();
          alert(data.detail || "Login failed!");
        }
      } catch (err) {
        console.error("Error logging in:", err);
        alert("Login request failed!");
      }
    });

    // Initial authentication check on page load.
    checkAuth();
  </script>
  <script src="/static/script.js"></script>
</body>

</html>
